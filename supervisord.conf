[supervisord]
nodaemon=true

# Headless X server on :0 with NVIDIA driver for VirtualGL (GPU-accelerated OpenGL over VNC).
# Start first so PyMOL and other OpenGL apps can use vglrun when container is run with --gpus all.
# Script exits 0 when no GPU so supervisord does not retry.
[program:xorg-nvidia]
command=/usr/local/bin/start-xorg-nvidia.sh
autorestart=true
startsecs=2
priority=1

[program:jupyterlab]
; Jupyter defaults to loopback for safety. Override via env if you explicitly publish it.
; Run as the non-root user to avoid --allow-root.
command=/bin/bash -lc "su - ${USER:-aXonian} -c 'jupyter lab --ip=${JUPYTER_BIND:-127.0.0.1} --port=${JUPYTER_PORT:-8888} --no-browser'"

[program:xfce4]
command=/bin/bash -lc "sleep 2 && su - aXonian -c 'DISPLAY=:0 startxfce4'"
environment=HOME="/home/aXonian",USER="aXonian",DISPLAY=":0",XAUTHORITY="/home/aXonian/.Xauthority",VGL_DISPLAY=":0"
directory=/home/aXonian

[program:x11vnc]
command=/bin/bash -c "sleep 3 && x11vnc -display :0 -rfbport 5901 -rfbauth /home/aXonian/.vnc/passwd -forever -shared -noxdamage"
environment=HOME="/home/aXonian",USER="aXonian",DISPLAY=":0",XAUTHORITY="/home/aXonian/.Xauthority",VGL_DISPLAY=":0"
directory=/home/aXonian

[program:novnc]
command=/bin/bash -c "sleep 3 && python3 /axonos_gate/websockify_gate.py"
; Configuration is provided via container environment variables.

[program:axgt-api]
command=/bin/bash -c "sleep 4 && python3 /axonos_gate/gate_server.py"
; Bind the separate AXGT API to localhost by default to reduce external surface.
; The primary verify endpoint is served on the same origin via websockify_gate.py.
; Configuration is provided via container environment variables (gate defaults are localhost:8889).

[program:ollama]
command=ollama serve
autorestart=true

[program:ipfs]
command=/bin/bash -c "sleep 5 && su - aXonian -c 'ipfs daemon --enable-gc --routing=dht'"
user=aXonian
environment=HOME="/home/aXonian",USER="aXonian"
directory=/home/aXonian
autorestart=true
autostart=true
